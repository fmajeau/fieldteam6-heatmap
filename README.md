# fieldteam6-heatmap
Shiny app to help Democratic Party volunteers identify high priority US congressional districts.  These are areas where registering Democrats could have a significant impact on the 2020 elections.  This tool was built for Field Team 6 (fieldteam6.org).

This app is built using Shiny, an R package for interactive web apps. It features a Leaflet map object.  This app relies on the free version of Shiny's cloud hosting service.

## Installation
1. Create shiny account [here](https://www.shinyapps.io/admin/#/signup) or use Field Team 6 account (talk to Fiona)

1. Get your R development environment set up & connected to shiny by following the [shiny documentation](https://shiny.rstudio.com/articles/shinyapps.html)

1. Link your shinyapps.io account to your github account (Open the shinyapps.io dashboard, navigate to  "Account" and scroll down to the Authentication section)

1. Run these commands in RStudio so shiny can find USAboundaries, a package used within the app which is not on CRAN (where shiny looks for the packages you want to import). 
```bash
devtools::install_github('USAboundaries')
rsconnect::deployApp()
```

## Usage
#### General
Running the project locally
* Call runApp() (or click Run App button) in your R development environment

Deploying the project 
* Call deployApp() which publishes to the shiny server
* RStudio has a Publish button which allows you to select which files you want as part of your deployment. The necessary files are:
	* global.R
	* ui.R
	* server.R
	* tl_2018_us_cd116_simplified.rds
	* fieldteam6_icon.png
	* fieldteam6_icon_bright.png
* When the deployment is complete, the app should open in a browser window

#### Pre-processing
This app requires a large amount of data. Simplifying and consolidating all of this raw data into an R object file speeds up the loading of the map display.  This R object file is already included in the project repo, but may need to be regenerated depending on the user's needs.  The *simplify_shapefile.R* file processes 4 raw data files:
* tl_2018_us_cd116.json
* member_info_cd116.csv
* member_info_senate116.xml
* target_class.csv

and consolidates them into the one R object file to be used during every live app sesssion:
* tl_2018_us_cd116_simplified.rds

**If you make any changes to simplify_shapefile.R or any of the 4 raw data files, you must rerun simplify_shapefile.R to rebuild tl_2018_us_cd116_simplified.rds.** Otherwise, the app will use the included version of tl_2018_us_cd116_simplified.rds.

#### Shiny app files
The minimum requirement for a shiny app is a ui.R file and server.R file. If a global.R file exists, it will be run at the start of each app session. 

*global.R*
Run once at the start of every session. Imports packages, defines constants, reads tl_2018_us_cd116_simplifed.rds into a SpatialPolygonsDataFrame variable, sends Mobilize API request for all future events, and processes events into usable dataframe.

*ui.R*
Holds the UI structure of the app. Defines the title, user input layout, map location, and table location. The GUI benefits of shiny should be apparent in the simplicity of this file.  This file displays the interactive objects that are generated in and controlled by the server file.

*server.R*
Holds the brains of the app. Defines all logic for generating and handling interactivity of the user inputs, map layers, event table, and district table. 


#### Other files required during live app session
*tl_2018_us_cd116_simplified.rds*
Holds the SpatialPolygonsDataFrame used by the app to display the congressional districts.  This file is generated by **simplify_shapefile.R** by lowering the resolution of the **tl_2018_us_cd116.json** polygons and adding information from **member_info_cd116.csv, member_info_senate116.xml, and target_class.csv.** This file is read in at the start of an app session. Since all of this raw data is static from one session to the next, letting the app read in the processed dataframe directly from the .rds file greatly improves the speed of the application.

*fieldteam6_icon.png*
Field Team 6 icon used to represent volunteer events on the map.

*fieldteam6_icon_bright.png*
Field Team 6 icon used to represent *selected* volunteer events on the map. Slightly brighter and has a thick black outline.

#### More details about the raw data files
*tl_2018_us_cd116.json*
Full resolution shapefile with US congressional district outlines. Downloaded directly from the [US Census Bureau](https://catalog.data.gov/harvest/116th-congressional-district)

*member_info_cd116.csv*
Holds information about the US congressional representatives.  Incorporated into tl_2018_us_cd116_simplified.rds in simplify_shapefile.R.  Not used in a normal app run, only when tl_2018_us_cd116_simplified.rds is re-built. Downloaded directly from [house website](http://clerk.house.gov/member_info/).

*member_info_senate116.xml*
Holds information about the US senators.  Incorporated into tl_2018_us_cd116_simplified.rds in simplify_shapefile.R.  Not used in a normal app run, only when tl_2018_us_cd116_simplified.rds is re-built. Downloaded directly from [senate website](https://www.senate.gov/general/contact_information/senators_cfm.cfm/).

*target_class.csv*
Stores the congressional district priority analysis performed by Jason Berlin. Specifies a ranking for each district based on the impact of registering an additional democratic voter on the house, senate, and presidential races. Incorporated into tl_2018_us_cd116_simplified.rds in simplify_shapefile.R.  Not used in a normal app run, only when tl_2018_us_cd116_simplified.rds is re-built.

